# Timing Analysis Scripts

## process_timing.py

Processes timing CSV files generated by the cache invalidation testing framework. Converts GPU clock cycles to nanoseconds and provides statistical analysis.

### Features

- **Automatic GPU frequency detection** via `nvidia-smi`
- **Cycle to nanosecond conversion** for GPU timing data
- **Statistical summaries** (mean, median, min, max, std deviation)
- **Acquire vs Relaxed comparison** for different memory orderings
- **Per-thread final buffer values** included in output

### Usage

Basic usage (auto-detects GPU frequency):
```bash
python scripts/process_timing.py timing_pattern_name_20241229_135549.csv
```

Specify GPU frequency manually (in GHz):
```bash
python scripts/process_timing.py timing_pattern_name_20241229_135549.csv --gpu-freq-ghz 1.8
```

Save to custom output file:
```bash
python scripts/process_timing.py timing_pattern_name_20241229_135549.csv -o results.csv
```

Skip summary statistics:
```bash
python scripts/process_timing.py timing_pattern_name_20241229_135549.csv --no-summary
```

### Output Format

The processed CSV includes all original columns plus:
- `duration_ns` - Duration in nanoseconds (GPU: converted from cycles, CPU: original)
- `wait_time_ns` - Wait time in nanoseconds (GPU: converted from cycles, CPU: original)
- `duration_corrected_ns` - Corrected duration in nanoseconds (GPU: converted from cycles, CPU: original)
- `final_value` - Final value read from buffer by this thread

### Example Output

```
Using GPU frequency: 1.755 GHz

================================================================================
TIMING SUMMARY (all values in nanoseconds)
================================================================================

GPU Threads:
--------------------------------------------------------------------------------

  reader_acq:
    Count: 2
    Wait time (ns):
      Mean:   11409.23
      Median: 11409.23
      Min:    11407.87
      Max:    11410.59
      Std:    1.36
    Duration corrected (ns):
      Mean:   11413.22
      Median: 11413.22
      Min:    11411.84
      Max:    11414.59
      Std:    1.37
    Final values: [100, 200]

  reader_rlx:
    Count: 254
    Wait time (ns):
      Mean:   11404.52
      Median: 11404.48
      Min:    11403.76
      Max:    11405.42
      Std:    0.29
    Duration corrected (ns):
      Mean:   11408.50
      Median: 11408.46
      Min:    11407.74
      Max:    11409.40
      Std:    0.29
    Final values: [100, 200]

================================================================================
ACQUIRE vs RELAXED COMPARISON
================================================================================

GPU:
  Acquire wait time (ns): 11409.23 ± 1.36
  Relaxed wait time (ns): 11404.52 ± 0.29
  Difference: 4.71 ns (0.04%)
```

### Notes

- GPU timing is measured in cycles using `clock64()` and converted to nanoseconds
- CPU timing is already in nanoseconds from `std::chrono::high_resolution_clock`
- Overhead correction is applied to GPU timing (3x calibration overhead)
- Final buffer values help verify correctness of memory synchronization
